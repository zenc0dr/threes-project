### Threes
Threes — это платформа для рекурсивно-модульного программирования, разработанная для упрощения и ускорения процесса разработки. Система позволяет разработчикам создавать гибкие и мощные приложения, используя концепции юнитов и спрайтов.

### Форма интеграции
В данном программном решении, платформа представлена в виде плагина к OctoberCMSv3, который в свою очередь работает на Laravel, что позволяет системе гибко развиваться в архитектурном плане и иметь готовые инструменты для построения интерфейсов.

### Основная логика кода

Инициация плагина начинается с файла `plugins/zen/threes/init.php` в котором объявляется хелпер Threes
```php
if (!function_exists('ths')) {  
    function ths(): \Zen\Threes\Threes
    {
        return \Zen\Threes\Threes::getInstance();
    }
}
```
>С этого момента, в системе доступен хелпер `ths()`

За хелпер `ths()` отвечает класс `Zen\Threes\Threes` который наследуется от класса `Zen\Threes\classes\Helpers`

### Методы ths()
| Метод        | Входные параметры                                                                                                                                                                   | Класс в `Zen\Threes\`     | Назначение                                                                                                                                                                                                                                                                                             |
| ------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| api          | `string $path*`  -  Путь до метода, включая класс<br>`string $method*`  -  Имя метода<br>`mixed $data` - Необяхательные передаваемые данные в метод                                 |                           | Базовый механизм внутреннего api, позволяет вызывать методы из папки `plugins/zen/threes/`<br>Пример: `ths()->api('debug.Tests', 'test');`<br>Данный метод api существует для динамической маршрутизации. Этот же метод можно запустить перейдя по ссылке http://threes.dc/threes.api/debug.Tests:test |
| settings     | `string $key`* - Ключ настройки                                                                                                                                                     | `Models\Settings`         | Доступ к настройкам плагина. Узнать какие поля в настройках существуют можно посмотрев файл `plugins/zen/threes/models/settings/fields.yaml`<br>На данный момент это author_token - Токен автора юнитов.                                                                                               |
| carbon       | `$date (null)` - Строка содержащая дату<br>`$format (null)` - Указание формата парсинга даты                                                                                        | `Classes\Helpers\Carbon`  | Преобразует строку $date в объет Carbon испольуя инструкцию $format                                                                                                                                                                                                                                    |
| requestSave  | `string $name` ("default") - Ключ запроса                                                                                                                                           | Classes\Helpers\Debug`    | Сохранить данные запроса (POST или GET)<br>Пример: `ths()->requestSave();`                                                                                                                                                                                                                             |
| requestLoad  | `string $name` ("default") - Ключ запроса                                                                                                                                           | `Classes\Helpers\Debug`   | Загрузить данные запроса                                                                                                                                                                                                                                                                               |
| requestExec  | `string $name` ("default") - Ключ запроса                                                                                                                                           | `Classes\Helpers\Debug`   | Выполнить запрос                                                                                                                                                                                                                                                                                       |
| requestDebug | `string $name` ("default") - Ключ запроса                                                                                                                                           | `Classes\Helpers\Debug`   | Автоматически сохранит данные если они подаются, и выполнит подгрузку данных если они НЕ подаются                                                                                                                                                                                                      |
| checkDir     | `string $file_path*` - Путь до файла<br>`int $permissions` (0777) - Права доступа<br>                                                                                               | `Classes\Helpers\Files`   | Проверить адрес файла и рекурсивно создать недостающие папки                                                                                                                                                                                                                                           |
| filesList    | `string $dir_path*` - Папка с файлами<br>`bool $recursive` (false)                                                                                                                  | `Classes\Helpers\Files`   | Возвращает коллекцию со списком файлов в указанной папке                                                                                                                                                                                                                                               |
| fromJson     | `string $string*` - Строка json<br>`int\|bool $assoc` (true) - Ассоциативный массив                                                                                                 | `Classes\Helpers\Json`    | Преобразовать json-строку в массив                                                                                                                                                                                                                                                                     |
| fromJsonFile | `string $file_path*` - Путь до json<br>`int\|bool $assoc` (true) - Ассоциативный массив                                                                                             | `Classes\Helpers\Json`    | Прочитать массив из json-файла                                                                                                                                                                                                                                                                         |
| toJson       | `array $arr*` - Входной массив<br>`bool $pretty_print` (true) - Красивый json  <br>`bool $no_slashes`  (false) - Подавлять экранирование                                            | `Classes\Helpers\Json`    | Преобразовать массив в json-строку                                                                                                                                                                                                                                                                     |
| toJsonFile   | `string $file_path*` - Путь до json<br>`array $arr*` - Входной массив<br>`bool $pretty_print` (true) - Красивый json  <br>`bool $no_slashes`  (false) - Подавлять экранирование<br> | `Classes\Helpers\Json`    | Сохранить массив в json-файл                                                                                                                                                                                                                                                                           |
| fromYaml     | `string $string` - Yaml-строка                                                                                                                                                      | `Classes\Helpers\Yaml`    | Преобразовать yaml-строку в массив                                                                                                                                                                                                                                                                     |
| fromYamlFile | `string $file_path*` - Путь до yaml<br>`int\|bool $assoc` (true) - Ассоциативный массив                                                                                             | `Classes\Helpers\Yaml`    | Прочитать массив из yaml-файла                                                                                                                                                                                                                                                                         |
| toYaml       | `array $arr*` - Входной массив<br>`int $inline` (10) - Вложенность<br>`int $indent` (4) - Отступы                                                                                   | `Classes\Helpers\Yaml`    | Преобразовать массив в yaml-строку                                                                                                                                                                                                                                                                     |
| toYamlFile   | `string $file_path*` - Путь к файлу<br>`int $inline` (10) - Вложенность<br>`int $indent` (4) - Отступы                                                                              | `Classes\Helpers\Yaml`    | Сохранить массив в yaml-файл                                                                                                                                                                                                                                                                           |
| createUuid   |                                                                                                                                                                                     | `Classes\Helpers\Strings` | Сгенерировать UUID                                                                                                                                                                                                                                                                                     |
| createToken  | `int $length` (8) - Длинна строки                                                                                                                                                   | `Classes\Helpers\Strings` | Сгенерировать случайную строку с заданной длинной                                                                                                                                                                                                                                                      |

### Консольные команды artisan
| Команда                   | Описание                                                                                                            |
| ------------------------- | ------------------------------------------------------------------------------------------------------------------- |
| php artisan threes:vector | Сгенерировать описание кода файлов проекта для ai-анализа, в виде одного `.md` файла `app/storage/threes_vector.md` |

### Описание классов

###### Helpers - Колекция публичных методов
`app/plugins/zen/threes/classes/Helpers.php`
Данный класс является источником чейнинга для базовых методов Threes, таких как `units`, `sprites`, `sets` то есть их можно вызывать так:
```php
ths()->units()->
ths()->sprites()->
ths()->sets()->
```

Также данный класс является провайдером для коллекции трейтов которые в свою очередь доставляют свои методы и могут доставлять методы других классов. На момент написания этой документации, в секции USE можно наблюдать следующие подключённые классы:
```php
use Debug;    # Методы отладки
use Files;    # Работа с файлами
use Json;     # Работа с JSON
use Yaml;     # Работа с YAML
use Strings;  # Слой настроек
use State;    # Управлением состоянием (сессия Threes)
use Carbon;   # Создание объекта Carbon
```

###### Set - Система хранения
`plugins/zen/threes/classes/Set.php`
По сути это простая `nosql` система хранения данных вида key:value (KVS) которая хранит свои записи в таблице `zen_threes_sets`
**Пример**
```php
# Записать
ths()->sets()->set('ключ', 'значение', 'пространство', ['tag1', 'tag2', 'tag3']); // пространство и тэги не обязательны

# Получить
ths()->sets()->get('ключ'); // Вернёт значение в том типе данных в котором оно сохранялось

# Получить массив
ths()->sets()->getBatch(tags: ['tag1']); // Вернётся ассоциативный массив у которого в качестве ключей uuid, вернуться только записи соответствующие тегу
ths()->sets()->getBatch(scope: 'пространство'); // Вернётся коллекция по пространству
```

###### State - Система данных сессии Threes
`app/plugins/zen/threes/classes/helpers/State.php`
Данный трейт дополняет набор хелперов Threes, он нужен для сохранения и извлечения данных в режиме одной сессии. Важно понимать что для того чтобы правильно оперировать данными сессии, необходимо отчётливо понимать последовательность выполнения.
**Пример**
```php
ths()->setState('ключ', 'значение'); # Установить значение в сессии
# Далее в другом месте
$state = ths()->getState('ключ'); # Получить значение в сессии
```

### Структура фронтенда

Компоненты для сборки фронтенда находятся в папке `plugins/zen/threes/src/vue`
`pages/ThreesProgram.vue` - Интерфейс программы
	`components/SelectNode.vue` - Компонент выбора нода
		`components/SelectNode.vue` - Компонент выбора юнита



### Рефакторинг 1
###### Добавление нового нода в программу (deprecated)
Тут хочу обратить внимание на механику добавления нода. Новый нод попадает на схему через метод `pages/ThreesProgram@addNodeToProgram` который принимает на вход json-объект нового нода которы был пораждён на бэкенде эндпоинтом `Units.SelectUnit:makeNode` (например этот запрос делается в компоненте `components/SelectUnit.vue`), сам метод располагается соответственно тут `plugins/zen/threes/api/units/SelectUnit.php`.


Суть рефакторинг